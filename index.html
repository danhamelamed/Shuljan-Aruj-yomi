<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Shulján Aruj Yomi</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=David+Libre&display=swap');

body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  background-color: #f4f4f4;
}
header {
  background-color: #d0e6f7;
  color: #333;
  text-align: center;
  padding: 1em;
  font-size: 1.5em;
  font-weight: bold;
}
.container {
  padding: 20px;
  max-width: 800px;
  margin: auto;
  background-color: white;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}
.section {
  margin-bottom: 20px;
}
.label {
  font-weight: bold;
  margin-bottom: 5px;
  display: block;
}
.toolbar {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  margin-bottom: 20px;
  gap: 10px;
}
.toolbar select,
.toolbar button {
  padding: 8px;
  font-size: 1em;
}
.turim-marquee {
  background-color: #e2f0d9;
  padding: 0.5em;
  font-size: 1em;
  white-space: nowrap;
  overflow: hidden;
  box-sizing: border-box;
}
.turim-marquee span {
  display: inline-block;
  padding-left: 100%;
  animation: marquee 20s linear infinite;
}
@keyframes marquee {
  0% {
    transform: translateX(0);
  }
  100% {
    transform: translateX(-100%);
  }
}
/* Fuente y estilo para hebreo */
#hebrew {
  font-family: 'David Libre', serif;
  font-size: 1.3em;
  direction: rtl;
  text-align: right;
  line-height: 1.6;
}
</style>
</head>
<body>
<header>Shulján Aruj Yomi</header>
<div class="turim-marquee"><span>Oraj Jaim • Ioré Deá • Even Haézer • Joshen Mishpat • Oraj Jaim • Ioré Deá • Even Haézer • Joshen Mishpat •</span></div>
<div class="container">
  <div class="toolbar">
    <select id="simanSelector" onchange="changeSiman()"></select>
    <div>
      <button onclick="previousSiman()">Simán Anterior</button>
      <button onclick="nextSiman()">Siguiente Simán</button>
      <button onclick="downloadPDF()">Descargar PDF</button>
    </div>
  </div>

  <div class="section">
    <span class="label">Hebreo:</span>
    <div id="hebrew"></div>
  </div>

  <div class="section">
    <span class="label">Traducción:</span>
    <div id="translation"></div>
  </div>
  <div class="section">
    <span class="label">Explicación:</span>
    <div id="explanation"></div>
  </div>
  <div id="status"></div>
</div>

<script>
let currentSiman = 1;

const hebrewDiv = document.getElementById("hebrew");
const translationDiv = document.getElementById("translation");
const explanationDiv = document.getElementById("explanation");
const statusDiv = document.getElementById("status");
const simanSelector = document.getElementById("simanSelector");

// Llenar el selector con 697 simanim
for (let i = 1; i <= 697; i++) {
  const option = document.createElement("option");
  option.value = i;
  option.textContent = `Simán ${i}`;
  simanSelector.appendChild(option);
}
simanSelector.value = currentSiman;

async function loadSiman() {
  statusDiv.innerText = "Cargando...";
  hebrewDiv.innerText = "";
  translationDiv.innerText = "";
  explanationDiv.innerText = "";

  try {
    const response = await fetch(
      "https://shuljan-aruj-api.danfuenteslopez.workers.dev/",
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ siman: currentSiman }),
      }
    );

    if (!response.ok) {
      const error = await response.text();
      statusDiv.innerText = "Error en el servidor.";
      console.error(error);
      return;
    }

    const text = await response.text();
    try {
      const data = JSON.parse(text);

      function formatSeifim(text) {
        const seifim = text.split(/\(\d+\)/).filter(Boolean);
        return seifim
          .map(
            (seif, index) =>
              `<p><strong>(${index + 1})</strong> ${seif.trim()}</p>`
          )
          .join("");
      }

      hebrewDiv.innerHTML = formatSeifim(data.hebrew || "");
      translationDiv.innerHTML = formatSeifim(data.translation || "");
      explanationDiv.innerHTML = formatSeifim(data.explanation || "");
      statusDiv.innerText = `Simán ${currentSiman}`;
    } catch (parseError) {
      statusDiv.innerText = "Respuesta no válida del servidor.";
      console.error("Respuesta cruda:", text);
    }
  } catch (error) {
    console.error(error);
    statusDiv.innerText = "Error de conexión.";
  }
}

function changeSiman() {
  currentSiman = parseInt(simanSelector.value);
  loadSiman();
}

function nextSiman() {
  if (currentSiman < 697) {
    currentSiman++;
    simanSelector.value = currentSiman;
    loadSiman();
  }
}

function previousSiman() {
  if (currentSiman > 1) {
    currentSiman--;
    simanSelector.value = currentSiman;
    loadSiman();
  }
}

function downloadPDF() {
  const contenido = `Simán ${currentSiman}\n\nHebreo:\n${hebrewDiv.innerText}\n\nTraducción:\n${translationDiv.innerText}\n\nExplicación:\n${explanationDiv.innerText}`;
  const blob = new Blob([contenido], { type: "application/pdf" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = `shuljan_aruj_siman${currentSiman}.pdf`;
  link.click();
}

// Cargar el primer Simán
loadSiman();
</script>
</body>
</html>
